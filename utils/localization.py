"""
Localization module for the video converter bot.
Provides translations for bot messages in multiple languages.
"""
from typing import Dict, Any, Optional

# Default language
DEFAULT_LANGUAGE = "ru"

# User language cache
USER_LANGUAGES: Dict[int, str] = {}

# Available languages
LANGUAGES = {
    "ru": "–†—É—Å—Å–∫–∏–π",
    "en": "English",
    "uz": "O'zbek"
}

# Translations dictionary
TRANSLATIONS: Dict[str, Dict[str, Dict[str, str]]] = {
    # –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã –∏ –∫–Ω–æ–ø–∫–∏
    "common": {
        "ru": {
            "back": "–ù–∞–∑–∞–¥",
            "cancel": "–û—Ç–º–µ–Ω–∞",
            "operation_canceled": "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.",
            "processing_success": "‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç",
            "video_result": "–í–∏–¥–µ–æ –ø–æ—Å–ª–µ"
        },
        "en": {
            "back": "Back",
            "cancel": "Cancel",
            "operation_canceled": "‚ùå Operation canceled.",
            "processing_success": "‚úÖ Video successfully processed! Result of",
            "video_result": "Video after"
        },
        "uz": {
            "back": "Orqaga",
            "cancel": "Bekor qilish",
            "operation_canceled": "‚ùå Operatsiya bekor qilindi.",
            "processing_success": "‚úÖ Video muvaffaqiyatli qayta ishlandi! Natija",
            "video_result": "Video keyin"         
        }
    },
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
    "convert_operation": {
        "ru": {
            "result_text": "–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤"
        },
        "en": {
            "result_text": "conversion to"
        },
        "uz": {
            "result_text": "konvertatsiya"
        }
    },
    
    # –°–∂–∞—Ç–∏–µ
    "compress_operation": {
        "ru": {
            "high_quality": "–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
            "medium_quality": "–°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
            "low_quality": "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ", 
            "high": "–≤—ã—Å–æ–∫–∏–º",
            "medium": "—Å—Ä–µ–¥–Ω–∏–º",
            "low": "–Ω–∏–∑–∫–∏–º",
            "quality": "–∫–∞—á–µ—Å—Ç–≤–æ–º",
            "result_text": "—Å–∂–∞—Ç–∏—è —Å"
        },
        "en": {
            "high_quality": "High quality",
            "medium_quality": "Medium quality",
            "low_quality": "Low quality",
            "high": "high",
            "medium": "medium",
            "low": "low",
            "quality": "quality",
            "result_text": "compression with"
        },
        "uz": {
            "high_quality": "Yuqori sifat",
            "medium_quality": "O'rta sifat",
            "low_quality": "Past sifat",
            "high": "yuqori",
            "medium": "o'rta",
            "low": "past",
            "quality": "sifat",
            "result_text": "siqish"
        }
    },
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
    "extract_audio_operation": {
        "ru": {
            "result_text": "–∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—É–¥–∏–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ",
            "with_bitrate": "—Å –±–∏—Ç—Ä–µ–π—Ç–æ–º",
            "caption": "–ê—É–¥–∏–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –≤–∏–¥–µ–æ"
        },
        "en": {
            "result_text": "audio extraction in format",
            "with_bitrate": "with bitrate",
            "caption": "Audio extracted from video"
        },
        "uz": {
            "result_text": "audio chiqarish formatida",
            "with_bitrate": "bitreyt bilan",
            "caption": "Videodan audio chiqarildi"
        }
    },
    
    # –û–±—Ä–µ–∑–∫–∞ –≤–∏–¥–µ–æ
    "trim_operation": {
        "ru": {
            "to": "–¥–æ",
            "sec": "—Å–µ–∫",
            "to_end": "–¥–æ –∫–æ–Ω—Ü–∞",
            "result_text": "–æ–±—Ä–µ–∑–∫–∏",
            "from": "—Å",
            "start_time": "‚úÇÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ—Ç—Ä–µ–∑–∫–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö –∏–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM:SS):",
            "end_time": "‚úÇÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è –∫–æ–Ω—Ü–∞ –æ—Ç—Ä–µ–∑–∫–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö, —Ñ–æ—Ä–º–∞—Ç–µ MM:SS –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤):",
            "invalid_time_format": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –∏–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM:SS:",
            "positive_time": "‚ùå –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:",
            "end_greater_than_start": "‚ùå –í—Ä–µ–º—è –∫–æ–Ω—Ü–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ ({start_time}). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞:",
            "end_of_video": "–ö–æ–Ω–µ—Ü –≤–∏–¥–µ–æ",
            "preset_10_sec": "+10 —Å–µ–∫",
            "preset_30_sec": "+30 —Å–µ–∫",
            "preset_1_min": "+1 –º–∏–Ω",
            "preset_2_min": "+2 –º–∏–Ω",
            "preset_5_min": "+5 –º–∏–Ω",
            "preset_10_min": "+10 –º–∏–Ω",
            "processing": "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≤–∏–¥–µ–æ...",
            "error_occurred": "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {error}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
            "insufficient_data": "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ."
        },
        "en": {
            "to": "to",
            "sec": "sec",
            "to_end": "to the end",
            "result_text": "trimming",
            "from": "from",
            "start_time": "‚úÇÔ∏è Enter the start time of the segment (in seconds or MM:SS format):",
            "end_time": "‚úÇÔ∏è Enter end time (seconds, MM:SS format, or select from options):",
            "invalid_time_format": "‚ùå Invalid time format. Please enter time in seconds or MM:SS format:",
            "positive_time": "‚ùå Start time should be a positive number. Please try again:",
            "end_greater_than_start": "‚ùå End time must be greater than start time ({start_time}). Please try again:",
            "end_of_video": "End of video",
            "preset_10_sec": "+10 sec",
            "preset_30_sec": "+30 sec",
            "preset_1_min": "+1 min",
            "preset_2_min": "+2 min",
            "preset_5_min": "+5 min",
            "preset_10_min": "+10 min",
            "processing": "‚è≥ Processing video...",
            "error_occurred": "‚ùå An error occurred: {error}. Please try again.",
            "insufficient_data": "‚ùå Insufficient data for video processing."
        },
        "uz": {
            "to": "gacha",
            "sec": "soniya",
            "to_end": "oxirigacha",
            "result_text": "qirqish",
            "from": "dan",
            "start_time": "‚úÇÔ∏è Segment boshlanish vaqtini kiriting (soniyalarda yoki MM:SS formatida):",
            "end_time": "‚úÇÔ∏è Tugash vaqtini kiriting (soniyalar, MM:SS formatida yoki variantlardan tanlang):",
            "invalid_time_format": "‚ùå Noto'g'ri vaqt formati. Iltimos, vaqtni soniyalarda yoki MM:SS formatida kiriting:",
            "positive_time": "‚ùå Boshlanish vaqti musbat son bo'lishi kerak. Iltimos, qayta urinib ko'ring:",
            "end_greater_than_start": "‚ùå Tugash vaqti boshlanish vaqtidan katta bo'lishi kerak ({start_time}). Iltimos, qayta urinib ko'ring:",
            "end_of_video": "Video oxiri",
            "preset_10_sec": "+10 soniya",
            "preset_30_sec": "+30 soniya",
            "preset_1_min": "+1 daqiqa",
            "preset_2_min": "+2 daqiqa",
            "preset_5_min": "+5 daqiqa",
            "preset_10_min": "+10 daqiqa",
            "processing": "‚è≥ Video qayta ishlanmoqda...",
            "error_occurred": "‚ùå Xatolik yuz berdi: {error}. Iltimos, qayta urinib ko'ring.",
            "insufficient_data": "‚ùå Video qayta ishlash uchun ma'lumotlar yetarli emas."
        }
    },
    
    # Command descriptions
    "command_descriptions": {
        "ru": {
            "start": "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º",
            "help": "–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É",
            "convert": "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ",
            "compress": "–°–∂–∞—Ç—å –≤–∏–¥–µ–æ",
            "extract_audio": "–ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ –∏–∑ –≤–∏–¥–µ–æ",
            "trim": "–û–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ",
            "cancel": "–û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é",
            "settings": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞",
        },
        "en": {
            "start": "Start working with the bot",
            "help": "Show help",
            "convert": "Convert video",
            "compress": "Compress video",
            "extract_audio": "Extract audio from video",
            "trim": "Trim video",
            "cancel": "Cancel current operation",
            "settings": "Bot settings",
        },
        "uz": {
            "start": "Bot bilan ishlashni boshlash",
            "help": "Yordam ko'rsatish",
            "convert": "Videoni konvertatsiya qilish",
            "compress": "Videoni siqish",
            "extract_audio": "Videodan audio ajratib olish",
            "trim": "Videoni qirqish",
            "cancel": "Joriy operatsiyani bekor qilish",
            "settings": "Bot sozlamalari",
        }
    },
    
    # Start command
    "start": {
        "ru": {
            "greeting": "üëã –ü—Ä–∏–≤–µ—Ç, {username}!\n\n–Ø –±–æ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ. –Ø –º–æ–≥—É:\n‚Ä¢ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ –≤ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã\n‚Ä¢ –°–∂–∏–º–∞—Ç—å –≤–∏–¥–µ–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–∞—á–µ—Å—Ç–≤–∞\n‚Ä¢ –ò–∑–≤–ª–µ–∫–∞—Ç—å –∞—É–¥–∏–æ –∏–∑ –≤–∏–¥–µ–æ\n‚Ä¢ –û–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –≤–∏–¥–µ–æ –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.\n–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤–≤–µ–¥–∏—Ç–µ /help.",
        },
        "en": {
            "greeting": "üëã Hello, {username}!\n\nI'm a video processing bot. I can:\n‚Ä¢ Convert videos to different formats\n‚Ä¢ Compress videos while maintaining quality\n‚Ä¢ Extract audio from videos\n‚Ä¢ Trim videos and audio\n\nSend me a video or a link to a video to get started.\nTo view available commands, type /help.",
        },
        "uz": {
            "greeting": "üëã Salom, {username}!\n\nMen video qayta ishlash botiman. Men quyidagilarni qila olaman:\n‚Ä¢ Videolarni turli formatlarga o'zgartirish\n‚Ä¢ Videolarni sifatini saqlagan holda siqish\n‚Ä¢ Videodan audio ajratib olish\n‚Ä¢ Video va audiolarni qirqish\n\nBoshlash uchun menga video yoki videoga havola yuboring.\nMavjud buyruqlarni ko'rish uchun /help deb yozing.",
        }
    },
    
    # Help command
    "help": {
        "ru": {
            "title": "üìã –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥",
            "how_to_use": "üìù –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è",
            "how_to_use_steps": "1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∏–¥–µ–æ –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ\n2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å\n3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –±–æ—Ç–∞",
            "limitations": "‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è",
            "max_file_size": "‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {max_file_size} –ú–ë",
            "max_requests": "‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É: {max_requests}",
        },
        "en": {
            "title": "üìã Command List",
            "how_to_use": "üìù How to Use",
            "how_to_use_steps": "1. Send a video or a link to a video\n2. Choose the action you want to perform\n3. Follow the bot's instructions",
            "limitations": "‚ö†Ô∏è Limitations",
            "max_file_size": "‚Ä¢ Maximum file size: {max_file_size} MB",
            "max_requests": "‚Ä¢ Maximum number of requests per minute: {max_requests}",
        },
        "uz": {
            "title": "üìã Buyruqlar ro'yxati",
            "how_to_use": "üìù Qanday foydalanish",
            "how_to_use_steps": "1. Video yoki videoga havola yuboring\n2. Bajarmoqchi bo'lgan harakatni tanlang\n3. Botning ko'rsatmalariga amal qiling",
            "limitations": "‚ö†Ô∏è Cheklovlar",
            "max_file_size": "‚Ä¢ Maksimal fayl hajmi: {max_file_size} MB",
            "max_requests": "‚Ä¢ Bir daqiqada maksimal so'rovlar soni: {max_requests}",
        }
    },
    
    # Operation selection
    "operation_selection": {
        "ru": {
            "title": "üé¨ –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å –≤–∏–¥–µ–æ:",
            "convert": "üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å",
            "compress": "üóúÔ∏è –°–∂–∞—Ç—å",
            "extract_audio": "üîä –ò–∑–≤–ª–µ—á—å –∞—É–¥–∏–æ",
            "trim": "‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å",
        },
        "en": {
            "title": "üé¨ Select the operation to perform on the video:",
            "convert": "üîÑ Convert",
            "compress": "üóúÔ∏è Compress",
            "extract_audio": "üîä Extract audio",
            "trim": "‚úÇÔ∏è Trim",
        },
        "uz": {
            "title": "üé¨ Video bilan bajarish kerak bo'lgan operatsiyani tanlang:",
            "convert": "üîÑ Konvertatsiya",
            "compress": "üóúÔ∏è Siqish",
            "extract_audio": "üîä Audio ajratish",
            "trim": "‚úÇÔ∏è Qirqish",
        }
    },
    
    # Format selection
    "format_selection": {
        "ru": {
            "title": "üîÑ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:",
            "cancel": "–û—Ç–º–µ–Ω–∞",
        },
        "en": {
            "title": "üîÑ Select the format for conversion:",
            "cancel": "Cancel",
        },
        "uz": {
            "title": "üîÑ Konvertatsiya uchun formatni tanlang:",
            "cancel": "Bekor qilish",
        }
    },
    
    # Quality selection
    "quality_selection": {
        "ru": {
            "title": "üóúÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è:",
            "high": "–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
            "medium": "–°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
            "low": "–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
            "cancel": "–û—Ç–º–µ–Ω–∞",
        },
        "en": {
            "title": "üóúÔ∏è Select compression quality:",
            "high": "High quality",
            "medium": "Medium quality",
            "low": "Low quality",
            "cancel": "Cancel",
        },
        "uz": {
            "title": "üóúÔ∏è Siqish sifatini tanlang:",
            "high": "Yuqori sifat",
            "medium": "O'rta sifat",
            "low": "Past sifat",
            "cancel": "Bekor qilish",
        }
    },
    
    # Audio format selection
    "audio_format_selection": {
        "ru": {
            "title": "üîä –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ:",
            "cancel": "–û—Ç–º–µ–Ω–∞",
        },
        "en": {
            "title": "üîä Select audio format:",
            "cancel": "Cancel",
        },
        "uz": {
            "title": "üîä Audio formatini tanlang:",
            "cancel": "Bekor qilish",
        }
    },
    
    # Bitrate selection
    "bitrate_selection": {
        "ru": {
            "title": "üîä –í—ã–±–µ—Ä–∏—Ç–µ –±–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ:",
            "high": "–í—ã—Å–æ–∫–æ–µ (320k)",
            "medium": "–°—Ä–µ–¥–Ω–µ–µ (192k)",
            "low": "–ù–∏–∑–∫–æ–µ (128k)",
            "cancel": "–û—Ç–º–µ–Ω–∞",
        },
        "en": {
            "title": "üîä Select audio bitrate:",
            "high": "High (320k)",
            "medium": "Medium (192k)",
            "low": "Low (128k)",
            "cancel": "Cancel",
        },
        "uz": {
            "title": "üîä Audio bitreytini tanlang:",
            "high": "Yuqori (320k)",
            "medium": "O'rta (192k)",
            "low": "Past (128k)",
            "cancel": "Bekor qilish",
        }
    },
    
    # Processing status
    "processing_status": {
        "ru": {
            "receiving_video": "‚è≥ –ü–æ–ª—É—á–∞—é –≤–∏–¥–µ–æ...",
            "downloading_video": "‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –≤–∏–¥–µ–æ –ø–æ —Å—Å—ã–ª–∫–µ...",
            "processing_video": "‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≤–∏–¥–µ–æ...",
            "success": "‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç {operation_text}:",
            "audio_extraction_caption": "–ê—É–¥–∏–æ –∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ –≤–∏–¥–µ–æ ({format}, {bitrate})",
            "video_processing_caption": "–í–∏–¥–µ–æ –ø–æ—Å–ª–µ {operation_text}",
        },
        "en": {
            "receiving_video": "‚è≥ Receiving video...",
            "downloading_video": "‚è≥ Downloading video from link...",
            "processing_video": "‚è≥ Processing video...",
            "success": "‚úÖ Video successfully processed! Result of {operation_text}:",
            "audio_extraction_caption": "Audio extracted from video ({format}, {bitrate})",
            "video_processing_caption": "Video after {operation_text}",
        },
        "uz": {
            "receiving_video": "‚è≥ Video qabul qilinmoqda...",
            "downloading_video": "‚è≥ Havoladan video yuklab olinmoqda...",
            "processing_video": "‚è≥ Video qayta ishlanmoqda...",
            "success": "‚úÖ Video muvaffaqiyatli qayta ishlandi! {operation_text} natijasi:",
            "audio_extraction_caption": "Videodan ajratilgan audio ({format}, {bitrate})",
            "video_processing_caption": "Video {operation_text} dan keyin",
        }
    },
    
    # Operation descriptions
    "operation_descriptions": {
        "ru": {
            "convert": "–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ {format}",
            "compress": "—Å–∂–∞—Ç–∏—è —Å {quality} –∫–∞—á–µ—Å—Ç–≤–æ–º",
            "extract_audio": "–∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—É–¥–∏–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ {format} —Å –±–∏—Ç—Ä–µ–π—Ç–æ–º {bitrate}",
            "trim": "–æ–±—Ä–µ–∑–∫–∏ (—Å {start_time} —Å–µ–∫{end_time_text})",
        },
        "en": {
            "convert": "conversion to {format}",
            "compress": "compression with {quality} quality",
            "extract_audio": "audio extraction in {format} format with {bitrate} bitrate",
            "trim": "trimming (from {start_time} sec{end_time_text})",
        },
        "uz": {
            "convert": "{format}ga konvertatsiya",
            "compress": "{quality} sifat bilan siqish",
            "extract_audio": "{format} formatida {bitrate} bitreyt bilan audio ajratish",
            "trim": "qirqish ({start_time} soniyadan{end_time_text})",
        }
    },
    
    # Quality descriptions
    "quality_descriptions": {
        "ru": {
            "high": "–≤—ã—Å–æ–∫–∏–º",
            "medium": "—Å—Ä–µ–¥–Ω–∏–º",
            "low": "–Ω–∏–∑–∫–∏–º",
        },
        "en": {
            "high": "high",
            "medium": "medium",
            "low": "low",
        },
        "uz": {
            "high": "yuqori",
            "medium": "o'rta",
            "low": "past",
        }
    },
    
    # Error messages
    "errors": {
        "ru": {
            "rate_limit_exceeded": "‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
            "download_failed": "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç {max_file_size} –ú–ë.",
            "url_download_failed": "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ —Å—Å—ã–ª–∫–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ.",
            "invalid_url": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ.",
            "processing_error": "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–µ–æ: {error}",
            "no_active_operation": "‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã.",
            "operation_canceled": "‚úÖ –¢–µ–∫—É—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.",
            "unauthorized": "‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.",
        },
        "en": {
            "rate_limit_exceeded": "‚ö†Ô∏è Rate limit exceeded. Please try again later.",
            "download_failed": "‚ùå Failed to download the video. Make sure the file size does not exceed {max_file_size} MB.",
            "url_download_failed": "‚ùå Failed to download the video from the link. Check the link or try another video.",
            "invalid_url": "‚ùå Invalid URL format. Please send a valid video link.",
            "processing_error": "‚ùå An error occurred while processing the video: {error}",
            "no_active_operation": "‚ùå No active operation to cancel.",
            "operation_canceled": "‚úÖ Current operation canceled. You can start again.",
            "unauthorized": "‚ùå You do not have access to this command.",
        },
        "uz": {
            "rate_limit_exceeded": "‚ö†Ô∏è So'rovlar soni cheklangan. Iltimos, keyinroq qayta urinib ko'ring.",
            "download_failed": "‚ùå Videoni yuklab olish muvaffaqiyatsiz tugadi. Fayl hajmi {max_file_size} MB dan oshmasligiga ishonch hosil qiling.",
            "url_download_failed": "‚ùå Havoladan videoni yuklab olish muvaffaqiyatsiz tugadi. Havolani tekshiring yoki boshqa videoni sinab ko'ring.",
            "invalid_url": "‚ùå Noto'g'ri URL formati. Iltimos, to'g'ri video havolasini yuboring.",
            "processing_error": "‚ùå Videoni qayta ishlashda xatolik yuz berdi: {error}",
            "no_active_operation": "‚ùå Bekor qilish uchun faol operatsiya yo'q.",
            "operation_canceled": "‚úÖ Joriy operatsiya bekor qilindi. Siz qaytadan boshlashingiz mumkin.",
            "unauthorized": "‚ùå Sizda ushbu buyruqqa kirish huquqi yo'q.",
        }
    },
    
    # Settings
    "settings": {
        "ru": {
            "title": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
            "language": "üåê –Ø–∑—ã–∫: {current_language}",
            "change_language": "–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫",
        },
        "en": {
            "title": "‚öôÔ∏è Settings",
            "language": "üåê Language: {current_language}",
            "change_language": "Change language",
        },
        "uz": {
            "title": "‚öôÔ∏è Sozlamalar",
            "language": "üåê Til: {current_language}",
            "change_language": "Tilni o'zgartirish",
        }
    },
    
    # Language selection
    "language_selection": {
        "ru": {
            "title": "üåê –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:",
            "russian": "–†—É—Å—Å–∫–∏–π",
            "english": "English",
            "uzbek": "O'zbek",
            "language_changed": "‚úÖ –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π.",
        },
        "en": {
            "title": "üåê Select language:",
            "russian": "–†—É—Å—Å–∫–∏–π",
            "english": "English",
            "uzbek": "O'zbek",
            "language_changed": "‚úÖ Language changed to English.",
        },
        "uz": {
            "title": "üåê Tilni tanlang:",
            "russian": "–†—É—Å—Å–∫–∏–π",
            "english": "English",
            "uzbek": "O'zbek",
            "language_changed": "‚úÖ Til o'zbek tiliga o'zgartirildi.",
        }
    }
}

async def get_i18n_for_user(user_id: int) -> Dict[str, Dict[str, str]]:
    """
    Get localization dictionary for the user.
    
    Args:
        user_id: Telegram user ID
        
    Returns:
        Dictionary with translations for the user's language
    """
    # Get user language (default to Russian if not set)
    user_lang = USER_LANGUAGES.get(user_id, DEFAULT_LANGUAGE)
    
    # Create a dictionary with all translation sections for the user's language
    i18n = {}
    for section, translations in TRANSLATIONS.items():
        i18n[section] = translations.get(user_lang, translations[DEFAULT_LANGUAGE])
    
    return i18n


def get_text(category: str, key: str, language: str = "ru", **kwargs: Any) -> str:
    """
    Get localized text for the specified category, key, and language.
    
    Args:
        category: Category of the text (e.g., "start", "help", "errors")
        key: Key of the text within the category
        language: Language code (default: "ru")
        **kwargs: Format parameters for the text
        
    Returns:
        Localized text
    """
    # Fallback to Russian if the language is not supported
    if language not in LANGUAGES:
        language = "ru"
    
    # Get the text from the translations dictionary
    try:
        text = TRANSLATIONS[category][language][key]
        # Format the text with the provided parameters
        if kwargs:
            text = text.format(**kwargs)
        return text
    except KeyError:
        # Fallback to Russian if the translation is not available
        try:
            text = TRANSLATIONS[category]["ru"][key]
            if kwargs:
                text = text.format(**kwargs)
            return text
        except KeyError:
            # Return a placeholder if the translation is not found
            return f"[{category}.{key}]"


class UserLanguage:
    """
    Class for managing user language preferences.
    """
    
    def __init__(self):
        self._user_languages: Dict[int, str] = {}
    
    def get_user_language(self, user_id: int) -> str:
        """
        Get the language for a specific user.
        
        Args:
            user_id: Telegram user ID
            
        Returns:
            Language code (default: "ru")
        """
        return self._user_languages.get(user_id, "ru")
    
    def set_user_language(self, user_id: int, language: str) -> None:
        """
        Set the language for a specific user.
        
        Args:
            user_id: Telegram user ID
            language: Language code
        """
        if language in LANGUAGES:
            self._user_languages[user_id] = language


# Create a global instance
user_language = UserLanguage()
